# 03a-METAL: The Virtual Substrate

*   **File:** `docs/research/03a-METAL.md`
*   **Context:** Layer 1 Specification (Continuum Memory, Hardware Abstraction, & Security Tiers)
*   **Date:** December 14, 2025
*   **Status:** `v4.0` (The Apparatus Standard)

> **The Vacuum Chamber.**
> *To test the **Lawvere-Landauer Conjecture** (`01a`), we need a controlled environment. Standard operating systems are "noisy"â€”they move memory unpredictably and lack strict isolation. This paper defines the **LVM Substrate**: a rigid Virtual Instruction Set Architecture (vISA) that abstracts silicon into a **Continuum Memory System**. It enforces the **Two Tiers of Sovereignty** defined in `02f-SECURITY`, ensuring that the physics of the system matches the reality of the hardware.*

---

## 1. The Physical Atom: `SovereignVector`

The LVM ignores the host's native word size (32/64-bit). It enforces a uniform geometric standard derived from the axioms of **Space** (`02a-MATHS`).

### 1.1 The Genesis Origin
*   **The Seed:** Every vector space is initialized by a **`GenesisSeed`**.
*   **The Stream:** Vectors are slices of the deterministic ChaCha20 stream generated by the *current* state of the seed.

### 1.2 The Virtual Specification
*   **Physical Alignment:** 10,240 bits ($160 \times 64$-bit words).
*   **Rationale:** This specific dimensionality ensures the **Concentration of Measure** (Levy's Lemma) required for Holographic Robustness. It is the LCM of 64, 128, 256, and 512-bit SIMD lanes, ensuring optimal performance on all modern CPUs (AVX-512, NEON, RISC-V Vector).

---

## 2. The Continuum Memory System (CMS)

We replace the "RAM vs Disk" dichotomy with a **Thermodynamic Hierarchy** corresponding to the states of matter defined in `02b-PHYSICS`.

### Level 1: The Fovea (Liquid Phase)
*   **Physics:** High Temperature, High Plasticity.
*   **Hardware:** L1/L2 Cache & NPU SRAM.
*   **Function:** **Harmonic Diffusion.** This is where "Bundling" and "Melting" occur.
*   **Constraint:** **Finite Capacity.** The Fovea has a hard size limit (`LVM_FOVEA_CAPACITY`). Attempting to process more vectors than fit in the Fovea triggers a `Plasma::FoveaOverflow` error.

### Level 2: The Context (Gas Phase)
*   **Physics:** Medium Temperature, Low Mass.
*   **Hardware:** System RAM (Encrypted).
*   **Function:** **Active Memory.** Concepts waiting for attention.
*   **Security:** Uses unencrypted **Perceptual Hashes** for fast indexing, while the data payloads remain encrypted blobs.

### Level 3: The Deep Lattice (Crystal Phase)
*   **Physics:** Zero Temperature, High Mass.
*   **Hardware:** NVMe SSD / Disk-Resident Graph.
*   **Function:** **The Living Ledger.** Immutable history.
*   **Entropy Interleaving:** The LVM utilizes I/O wait-times to spawn background "Entropy Worker Threads" that maintain the ChaCha20 stream integrity.

---

## 3. The Runtime Topology: Tiered Sovereignty

Following the security doctrine of **`02f-SECURITY`**, the LVM implementation is strictly divided into two tiers via **Conditional Compilation**.

### Tier 1: Library Mode (Guest Sovereignty)
*   **Target:** Android (APK), Windows, Linux (User Space).
*   **Implementation:** `libcdqn` (Rust).
*   **Constraint:** The Host OS controls memory and I/O.
*   **Security:** **Best Effort.** The LVM cannot enforce "Physical Erasure" against a Root attacker.
*   **Compilation:** The **Antimatter Protocol** (Self-Destruct) is **excluded from the binary** (`#[cfg(not(feature = "sovereign"))]`) to prevent malware from triggering it.

### Tier 2: Sovereign Mode (Hardware Sovereignty)
*   **Target:** Raspberry Pi, RISC-V Boards, Robotics (Bare Metal).
*   **Implementation:** `cdqnOS` (Unikernel) + **TEE**.
*   **Constraint:** The LVM controls the silicon.
*   **Security:** **Absolute.** The `GenesisSeed` is anchored in the **Trusted Execution Environment (TEE)**.
*   **Compilation:** The **Antimatter Protocol** is **active**.

---

## 4. The Tri-Guard Security Protocol

We implement "Defense in Depth" within the Hardware Abstraction Layer (HAL).

| Guard Layer | Mechanism | The Check | Behavior |
| :--- | :--- | :--- | :--- |
| **1. Spatial** | **Virtual Arena** | *"Is this stack safe?"* | **Stack Safety.** Pre-allocated Arena prevents recursion overflows. |
| **2. Temporal** | **The Ouroboros** | *"Is this key fresh?"* | **Forward Secrecy.** See 4.1 below. |
| **3. Spectral** | **Boot Zeroing** | *"Is this memory clean?"* | **Causality.** See 4.2 below. |

### 4.1 The Ouroboros Constraint
*   **In Tier 2:** Old keys are overwritten with `0x00` and the memory cell is flushed via direct hardware instruction.
*   **In Tier 1:** Old keys are overwritten via `volatile_memset`.

### 4.2 The Boot Protocol (Temporal Consistency)
To prevent the **"Ghost Tick"** vulnerability:
*   **Volatile by Default:** On boot or recovery, the LVM Kernel **MUST** perform a `Force-Zero` overwrite of the entire Fovea and Context (RAM) allocation *before* loading the `GenesisSeed`.
*   **Physics:** Data from a previous session belongs to a dead timeline. It is mathematically invalid in the new session and must be purged.

---

## 5. The Execution Engine (The Bridge)

The LVM acts as a bridge between the **Chemical Logic** of the user (`02c`) and the **Binary Logic** of the chip.

*   **The Scheduler:** Translates `cdqnLang` interactions into Vector Operations.
*   **The Hysteresis Loop:** To prevent bus saturation, the engine batches operations based on the **Quantale Cost**. High-cost operations (Crystallization) are deferred to the background; low-cost operations (Binding) are immediate.

---

### ðŸ“‚ Bibliography & References
1.  **Peikert, C.** (2016). *"A Decade of Lattice Cryptography."* (Forward Secrecy foundations).
2.  **MartÃ­n-Olalla, J.M.** (2025). *"Thermal stability."* (Physics of Memory).
3.  **Jayaram, S. et al.** (2019). *"DiskANN."* (Disk-Resident Indexing).

---

**License:** Universal Sovereign Source License (USSL) v2.0.
